{% extends "base.html" %}

{% block content %}

<header id = "hiddenHeader" style="align:center">
    <img id="headerLogo" src="/static/images/logo2.png" alt="logo">
</header>

<div class="container-fluid">

    <div class="row">

                <div class="col-sm-12 padding-0">
                    <div id="map"></div>
                </div>

                </div>
    </div>



<footer>
    <div class="container-fluid">
        <div class="row">
    <div class="col-sm-2">
        <img class = "logo" id="footerLogo" src="/static/images/logo2.png" alt="logo">
    </div>


            <div class="col-sm-7">

                <div id="weather_wrapper" style="background-color: rgb(42, 178, 234);
        border: 2px rgb(42, 178, 234) solid; border-radius: 6px;">
                    <div class="weatherCard">
                        <div class="currentTemp">
                            <span class="temp"><span id="temp"></span>&deg;</span>
                            <span class="location">Dublin</span>
                        </div>
                        <div class="currentWeather">
                            <span class="conditions" id="image" style="color:black"></span>
                            <div class="info">
                                <span class="rain"><span id="precip"></span> MM</span>
                                <span class="wind"><span id="wind"></span> MPS</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>



    <div class="col-sm-3">
        <div style="width: 100%; margin-top:10px; margin-bottom:10px; height: auto; background-color: white;
        border: 2px rgb(42, 178, 234) solid; border-radius: 6px; text-align: center">
        <img src="{{url_for('static', filename='images/clock.png')}}" width="100px" height="auto" />
        <form action="/signUp" method="post" role="form" id="picker">
        <input type="date" name="date" id = "date">
        <input type="time" name="time" id = "time">
        <button onclick="searchXML()" class="btn btn-sm btn-primary btn-block" id = "timepick" type="button">Submit</button>
        </form>
        </div>
    </div>

        </div>
    </div>
</footer>


<script>
    <!--window.myWidgetParam ? window.myWidgetParam : window.myWidgetParam = [];-->
    <!--window.myWidgetParam.push({-->
        <!--id: 12,-->
        <!--cityid: '2964574',-->
        <!--appid: '718d1e3d695907c31b9a4b710e8348f5',-->
        <!--units: 'metric',-->
        <!--containerid: 'openweathermap-widget-12',-->
    <!--});-->
    <!--(function() {-->
        <!--var script = document.createElement('script');-->
        <!--script.async = true;-->
        <!--script.charset = "utf-8";-->
        <!--script.src = "//openweathermap.org/themes/openweathermap/assets/vendor/owm/js/weather-widget-generator.js";-->
        <!--var s = document.getElementsByTagName('script')[0];-->
        <!--s.parentNode.insertBefore(script, s);-->
    <!--})();-->
    <!--$(document).ready(function() {-->
        <!--$('#picker').dateTimePicker();-->
        <!--$('#picker-no-time').dateTimePicker({-->
            <!--showTime: false,-->
            <!--dateFormat: 'DD/MM/YYYY'-->
        <!--});-->
    <!--})-->
</script>

    <script>
        function initMap() {
            var options = {
                zoom:13,
                center:{lat:53.345,lng:-6.268}
            }
            //Add map
            var map = new google.maps.Map(document.getElementById('map'),options);
            //Add marker function
            function addMarker(coords,address,available_bike_stands='Unknown',available_bikes='Unknown'){
                //Add marker with custom icon at specified point
                if (available_bikes=='Unknown') {
            var marker = new google.maps.Marker({
                position:coords,
                map:map,
                icon:'./static/images/red_markerC.png'
            });
                } else if (available_bikes/available_bike_stands<0.25) {
                    var marker = new google.maps.Marker({
                    position:coords,
                    map:map,
                    icon:'./static/images/red_markerC.png'
                });
                } else if (available_bikes/available_bike_stands<0.5) {
                    var marker = new google.maps.Marker({
                    position:coords,
                    map:map,
                    icon:'./static/images/orange_markerC.png'
                }); 
                } else {
                    var marker = new google.maps.Marker({
                    position:coords,
                    map:map,
                    icon:'./static/images/green_markerC.png'
                });
                }
                marker.addListener('click',function() {
                var pos = marker.getPosition();
                var pos1 = {lat: pos.lat(),lng: pos.lng()}
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: '/infoWindow', 
                    data: JSON.stringify({lat: pos.lat(),lng: pos.lng()}),
                    success: function(response) {
               var response = JSON.parse(response);
                        infoWindow.setContent('<h1>'+response.address[0]+'</h1><br><p>Current number of bikestands:'+response.bikestands[0]+'</p><br><p>Current number of bikes:'+response.available_bikes[0]+'</p>'
             );
                    console.log(response);
                        
            },
            error: function(error) {
                console.log(error);
            }
                });
                    
                infoWindow.open(map, marker);
                setTimeout(function()
                           {infoWindow.close(map,marker);}, '100000');
                map.setCenter(marker.getPosition());
            });
                //add listener to display window above marker
                var infoWindow = new google.maps.InfoWindow({
                content:'<h1>'+address+'</h1><br><p>Current number of bikestands:'+available_bike_stands+'</p><br><p>Current number of bikes:'+available_bikes+'</p>'
                });
            }
            {% for item in range(0,len) %}
            var position = {lat:{{lat[item]}},lng:{{lng[item]}}};

           var specific_address ="{{address[item]}}"; 
            var bikestands = "{{bikestands[item]}}";
           var available_bikes = "{{available_bikes[item]}}";
            
          addMarker(position,specific_address,bikestands,available_bikes);
            {% endfor %}
        }
        
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAYZPR-bZ82RtqEpm2Zot3kMNaEZwxGKgM&callback=initMap"
    async defer></script>


{% endblock %}
